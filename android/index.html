<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>追一数字人Android端集成流程 | SDK文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="数字人SDK文档">
    
    <link rel="preload" href="/SDK-DOCS/assets/css/0.styles.ac97c713.css" as="style"><link rel="preload" href="/SDK-DOCS/assets/js/app.d94dd778.js" as="script"><link rel="preload" href="/SDK-DOCS/assets/js/2.eba0f677.js" as="script"><link rel="preload" href="/SDK-DOCS/assets/js/8.a85e4893.js" as="script"><link rel="prefetch" href="/SDK-DOCS/assets/js/10.dd425ca1.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/11.c1148ef8.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/12.3606478e.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/13.222379f1.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/14.2d001e5b.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/3.5a521647.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/4.0057816b.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/5.ad836a12.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/6.79bf5386.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/7.41db80e8.js"><link rel="prefetch" href="/SDK-DOCS/assets/js/9.487f0563.js">
    <link rel="stylesheet" href="/SDK-DOCS/assets/css/0.styles.ac97c713.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/SDK-DOCS/" class="home-link router-link-active"><!----> <span class="site-name">SDK文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SDK-DOCS/android/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/SDK-DOCS/en/android/" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/SDK-DOCS/android/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/SDK-DOCS/en/android/" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/SDK-DOCS/android/" aria-current="page" class="sidebar-heading clickable router-link-exact-active router-link-active open active"><span>Android文档</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/SDK-DOCS/android/" aria-current="page" class="active sidebar-link">追一数字人Android端集成流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#引入-sdk" class="sidebar-link">引入 SDK</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#配置sdk" class="sidebar-link">配置SDK</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#示例代码" class="sidebar-link">示例代码</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#环境初始化" class="sidebar-link">环境初始化</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#定义播放界面" class="sidebar-link">定义播放界面</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#初始化播放器" class="sidebar-link">初始化播放器</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#定义回调" class="sidebar-link">定义回调</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/SDK-DOCS/android/#演示项目" class="sidebar-link">演示项目</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/SDK-DOCS/ios/" class="sidebar-heading clickable"><span>IOS文档</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/SDK-DOCS/ios/" class="sidebar-link">追一数字人IOS端集成流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/SDK-DOCS/html5/" class="sidebar-heading clickable"><span>HTML5文档</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/SDK-DOCS/html5/" class="sidebar-link">追一数字人 HTML5集成流程</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="追一数字人android端集成流程"><a href="#追一数字人android端集成流程" class="header-anchor">#</a> 追一数字人Android端集成流程</h1> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <blockquote><p><code>SDK</code> 目前支持的最低安卓版本为 <code>Lolipop API 21</code></p></blockquote></div> <h2 id="引入-sdk"><a href="#引入-sdk" class="header-anchor">#</a> 引入 <code>SDK</code></h2> <p><code>SDK</code> 会以压缩包的形式提供，解压后通常包含两个包文件以及演示程序，比如：</p> <ul><li>libwebrtc-20211125.aar</li> <li>FACE.RELEASE-1.3.4-20211216.aar</li></ul> <p>将这两个文件放到安卓项目应用模块（通常是 <code>app</code>）的 <code>libs</code> 目录中。
Copy FACE.RELEASE-*.aar into your module's libs folder.</p> <h3 id="添加依赖"><a href="#添加依赖" class="header-anchor">#</a> 添加依赖</h3> <p>配置应用模块的 <code>build.gradle</code>，除了我们提供的两个 <code>aar</code> 文件以外，还需额外引入另外两个依赖用来支持 <code>WebSocket</code> 和 <code>JSON</code> 解析，最终的配置如下：
Add the aar library to your module's dependencies block:</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    implementation <span class="token function">files</span><span class="token punctuation">(</span><span class="token string">'libs/FACE.RELEASE-1.3.4-20211216.aar'</span><span class="token punctuation">)</span>
    implementation <span class="token function">files</span><span class="token punctuation">(</span><span class="token string">'libs/libwebrtc-20211125.aar'</span><span class="token punctuation">)</span>
    implementation <span class="token string">'org.java-websocket:Java-WebSocket:1.5.2'</span>
    implementation <span class="token string">'com.alibaba:fastjson:1.1.73.android'</span>
    <span class="token comment">// ...... others</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="配置sdk"><a href="#配置sdk" class="header-anchor">#</a> 配置SDK</h2> <h3 id="权限授予"><a href="#权限授予" class="header-anchor">#</a> 权限授予</h3> <p>SDK需要宿主APP授予如下权限：</p> <table><thead><tr><th>权限</th> <th>用途</th></tr></thead> <tbody><tr><td>INTERNET</td> <td>网络连接，允许数字人进行网络通信实现交互</td></tr> <tr><td>ACCESS_NETWORK_STATE</td> <td>检测联网通断，在网络异常状态下处理数字人异常情况</td></tr> <tr><td>MODIFY_AUDIO_SETTINGS</td> <td>播放音频控制，实现数字人音频调节</td></tr></tbody></table> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span> <span class="token attr-name">……</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.INTERNET<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.ACCESS_NETWORK_STATE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.MODIFY_AUDIO_SETTINGS<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span> <span class="token attr-name">……</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="示例代码"><a href="#示例代码" class="header-anchor">#</a> 示例代码</h2> <p>下面将以一个简单的代码示例，讲解如何在您的项目中集成追一数字人：</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>所有示例代码仅作参考，无法直接编译和运行，需根据实际情况进行修改。</p></div> <h2 id="环境初始化"><a href="#环境初始化" class="header-anchor">#</a> 环境初始化</h2> <p>initialize() 方法必须在初始化数字人之前调用，用来初始化 WebRTC 的运行环境，建议在Applicaiton.onCreate函数中调用</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// 初始化数字人运行坏境</span>
RTCPlayerClient<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span>
</code></pre></div><h2 id="定义播放界面"><a href="#定义播放界面" class="header-anchor">#</a> 定义播放界面</h2> <p>在 <code>res/layouts/player.xml</code> 中定义播放界面的控件，下面的例子中界面只有一个 <code>id</code> 为 <code>webrtc_view</code> 的 <code>SurfaceViewRenderer</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ai.zhuiyi.demo.PlayerActivity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>org.webrtc.SurfaceViewRenderer</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/webrtc_view<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gone<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="初始化播放器"><a href="#初始化播放器" class="header-anchor">#</a> 初始化播放器</h2> <p>创建 <code>PlayerActivity</code>，在 <code>onCreate()</code> 中初始化 <code>SDK</code>。</p> <h4 id="先定义类的属性"><a href="#先定义类的属性" class="header-anchor">#</a> 先定义类的属性：</h4> <p>kotlin示例：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// SurfaceViewRenderer</span>
<span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> view<span class="token operator">:</span> SurfaceViewRenderer
<span class="token comment">// 播放器对象</span>
<span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> playerClient<span class="token operator">:</span> RTCPlayerClient
</code></pre></div><p>java示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// SurfaceViewRenderer</span>
<span class="token keyword">private</span>  <span class="token class-name">SurfaceViewRenderer</span> view<span class="token punctuation">;</span>
<span class="token comment">// 播放器对象</span>
<span class="token keyword">private</span> <span class="token class-name">RTCPlayerClient</span> playerClient<span class="token punctuation">;</span>
</code></pre></div><h4 id="在-oncreate-中初始化"><a href="#在-oncreate-中初始化" class="header-anchor">#</a> 在 <code>onCreate()</code> 中初始化：</h4> <p>kotlin示例：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code>view <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>SurfaceViewRenderer<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>webrtc_view<span class="token punctuation">)</span>

<span class="token comment">// 初始化播放器</span>
playerClient <span class="token operator">=</span> RTCPlayerClient<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fromEndpoint</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span> <span class="token comment">// 数字人中控服务器连接 URL(必填)</span>
    <span class="token punctuation">.</span><span class="token function">setHttpApiPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>   <span class="token comment">// 数字人媒体服务器控制端口，(可选)</span>
    <span class="token punctuation">.</span><span class="token function">setView</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>          <span class="token comment">// 传入SurfaceViewRenderer实例(必填)</span>
    <span class="token punctuation">.</span><span class="token function">setVolumeScale</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>    <span class="token comment">// 默认安全音量50%(可选)</span>
    <span class="token punctuation">.</span><span class="token function">setIsMute</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token comment">// 是否静音，默认false(可选)</span>
    <span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">// 连接超时时间，默认10s（可选）</span>
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">,</span> EglBase<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 创建</span>
</code></pre></div><p>java示例：</p> <div class="language-java extra-class"><pre class="language-java"><code>view <span class="token operator">=</span> findViewById<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SurfaceViewRenderer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>webrtc_view<span class="token punctuation">)</span>

<span class="token comment">// 初始化播放器</span>
playerClient <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RTCPlayerClient<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fromEndpoint</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span> <span class="token comment">// 数字人中控服务器连接 URL(必填)</span>
    <span class="token punctuation">.</span><span class="token function">setHttpApiPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>   <span class="token comment">// 数字人媒体服务器控制端口，(可选)</span>
    <span class="token punctuation">.</span><span class="token function">setView</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>          <span class="token comment">// 传入SurfaceViewRenderer实例(必填)</span>
    <span class="token punctuation">.</span><span class="token function">setVolumeScale</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>    <span class="token comment">// 默认安全音量50%(可选)</span>
    <span class="token punctuation">.</span><span class="token function">setIsMute</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token comment">// 是否静音，默认false(可选)</span>
    <span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">// 连接超时时间，默认10s（可选）</span>
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">,</span> <span class="token class-name">EglBase</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 创建</span>
</code></pre></div><p>创建 <code>RTCPlayerClient</code> 实例的参数会在接入时由厂方技术人员提供。</p> <p><code>SDK</code> 支持 <code>Lolipop</code> 或者更高版本的安卓系统，应当在使用之前应当检查系统的版本是否支持运行数字人。</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>RTCPlayerClient<span class="token punctuation">.</span><span class="token function">isSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;当前版本的系统不支持数字人&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="定义回调"><a href="#定义回调" class="header-anchor">#</a> 定义回调</h2> <p>kotlin示例:</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code>playerClient<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> RTCPlayerObserver <span class="token punctuation">{</span>
    <span class="token comment">// 弱网检测</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPoorNetworkConnectionDetected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 连接超时</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onConnectionDisconnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 空闲时间超过 600 秒，退出系统并且触发此方法</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onIdleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 网络错误，任何需要网络的操作，比如发送语音命令时无法连接网络</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onNetworkError</span><span class="token punctuation">(</span>ex<span class="token operator">:</span> Exception<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 流媒体连接建立时</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onReceiveStream</span><span class="token punctuation">(</span>videoTrack<span class="token operator">:</span> VideoTrack<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 第一帧渲染完成时</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onFirstFrameRendered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 数字人开始语音播报时</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPlayStart</span><span class="token punctuation">(</span>text<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 数字人结束语音播报时</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPlayEnd</span><span class="token punctuation">(</span>text<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 收到来自中控服务器的语音消息（文本）时</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onMessage</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 中控服务器断开时</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSocketClosed</span><span class="token punctuation">(</span>code<span class="token operator">:</span> Int<span class="token punctuation">,</span> reason<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 中控服务器连接错误时，如果网络断开也会触发此方法但有延迟</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSocketError</span><span class="token punctuation">(</span>ex<span class="token operator">:</span> Exception<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// fps 检测</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onStatsUpdated</span><span class="token punctuation">(</span>fps<span class="token operator">:</span> int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>java示例:</p> <div class="language-java extra-class"><pre class="language-java"><code>playerClient<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">RTCPlayerObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPoorNetworkConnectionDetected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 弱网检测</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPoorNetworkConnectionDetected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConnectionDisconnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onConnectionDisconnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onIdleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 空闲时间超过 600 秒，退出系统并且触发此方法</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onIdleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNetworkError</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 网络错误，任何需要网络的操作，比如发送语音命令时无法连接网络</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onNetworkError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceiveStream</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">VideoTrack</span> videoTrack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 流媒体连接建立时</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onReceiveStream</span><span class="token punctuation">(</span>videoTrack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFirstFrameRendered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 第一帧渲染完成时</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onFirstFrameRendered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayStart</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Number</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 数字人开始语音播报时</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPlayStart</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPlayEnd</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Number</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 数字人结束语音播报时</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPlayEnd</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 收到来自中控服务器的语音消息（文本）时</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSocketClosed</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 中控服务器断开时</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSocketClosed</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSocketError</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 中控服务器连接错误时，如果网络断开也会触发此方法但有延迟</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSocketError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStatsUpdated</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// fps 检测</span>
        <span class="token class-name">RTCPlayerObserver</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStatsUpdated</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>以上列出了所有可用的回调函数，需要注意的是某些回调函数可能在非 <code>UI</code> 线程中被调用，比如 <code>onFirstFrameRendered</code>，
所以如果你要更新界面，需要把代码 <code>dispatch</code> 到主线程上面（比如使用：<code>runOnUiThread {}</code> ），以免出现 <code>ANR</code> 错误。</p> <p>所有回调函数的都是空实现，可不调用 <code>super.xxxx()</code>。</p> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <p>最后在 <code>PlayerActivity</code> 的生命周期方法中调用 <code>RTCPlayerClient</code> 的对应方法即可。</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    playerClient<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    playerClient<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    playerClient<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    playerClient<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="演示项目"><a href="#演示项目" class="header-anchor">#</a> 演示项目</h2> <p>完整的演示代码随 <code>SDK</code> 一起提供，包含在压缩包中。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/SDK-DOCS/ios/">
        追一数字人IOS端集成流程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/SDK-DOCS/assets/js/app.d94dd778.js" defer></script><script src="/SDK-DOCS/assets/js/2.eba0f677.js" defer></script><script src="/SDK-DOCS/assets/js/8.a85e4893.js" defer></script>
  </body>
</html>
